@model Entities.EventVM
@{
    ViewData["Title"] = "Book Event";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
    var eventdetails = new SelectList(Model.EventDetails, "eventID", "eventName");
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js">
</script>
<div class="page-header col-md-12">
    <div id="carouselId" class="carousel slide position-relative" data-bs-ride="carousel">
       <div id="EventBannerPV"></div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselId" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselId" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>
<br />
<!-- ======= Book A Table Section ======= -->
<section id="book-a-table" class="book-a-table">
    <div class="container" data-aos="fade-up">
        <div>

            <div class="card" id="snackbar2"></div>
            <div class="card" id="snackbar3"></div>
        </div>
        <div>
            <br />
            <div role="form" class="php-email-form" data-aos="fade-up" data-aos-delay="100" style="border:solid #9ad039 2px; border-radius:0px 50px; padding:15px;">
                <div class="row">
                    <input type="text" id="eventBookingId" hidden />
                    <div class="row">
                        <div class="col-md-4">
                            <div class="col-lg-12 col-md-12 form-group">
                                <select class="form-control" id="eventid" asp-items="@eventdetails"  onchange="hideInputBox();">
                                    <option value="" style="text-align:center;">&#8678; Select Event &#x21E8;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3 bname">
                        <input type="text" class="form-control" style="color:black; background-color:white;" name="bname" id="bname" placeholder="birthday person name">
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3 cname" style="display:none;">
                        <input type="text" class="form-control" style="color:black; background-color:white;" name="cname" id="cname" placeholder="couple name">
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3">
                        <input type="text" name="PhoneNo" class="form-control" style="color:black; background-color:white;" id="PhoneNo" placeholder="phone no">
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3">
                        <input type="number" class="form-control" style="color:black; background-color:white;" name="TotalGuest" id="TotalGuest" placeholder="no. of people" max="50" data-rule="minlen:1">
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3">
                        <input type="date" style="color:black; background-color:white;" name="date" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" id="date" placeholder="Date">

                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3">
                        <input type="time" style="color:black; background-color:white;" name="time" min="10:00" max="23:00" class="form-control" id="time" placeholder="Time">
                    </div>
                    <div class="col-lg-4 col-md-6 form-group mt-3">
                        <input type="text" name="Price" class="form-control" style="color:black; background-color:white;" disabled id="Price" placeholder="Price">
                    </div>
                </div>
                <div class="mb-3">
                </div>
                <div class="text-center"><button type="submit" class="btn border-secondary rounded-pill px-4 py-3 text-primary text-uppercase mb-4 ms-4" onclick="BookEvents();">Book Event</button></div>
            </div>
        </div>
        <div id="loader_spinner" style="display: none;" class="overlay-spinner"></div>
    </div>
</section>
<div id="PaymentModalPV"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function EventBanner() {
        $.post("/Banners/EventBanner").done(function (res) {
            $("#EventBannerPV").html(res);
        }).fail(function () {
            alert("errror");
        })
    }
    EventBanner();
    function hideInputBox() {
        debugger;
        var selectedValue = $("#eventid").val();
        OnEventChange(selectedValue);
        if (selectedValue != "1") {
            $(".bname").hide();
            $(".cname").show();
        } else {
            $(".bname").show();
            $(".cname").hide();
        }
    }
    function BookEvents() {
        debugger;
        Show_Loader();
        setTimeout(function () {
            if (validateEventBooking()) {
                let param = {
                    eventBookingId: $("#eventBookingId").val(),
                    eventID: $("#eventid").val(),
                    PhoneNo: $("#PhoneNo").val(),
                    TotalGuest: $("#TotalGuest").val(),
                    eventDate: $("#date").val(),
                    eventTime: $("#time").val(),
                    BPersonName: $("#bname").val(),
                    CoupleName: $("#cname").val(),
                    eventPrice: $("#Price").val(),
                };
                $.post('/Event/BookingEvent', param).done(function () {
                    Hide_Loader();
                    showinsertsuccess("Event Add Successfully");
                }).fail(function () {
                    Hide_Loader();
                    showerrors("Something went wrong!!!");
                });
            }
        }, 1500)
    }
    function OnEventChange(id) {
        var param = {
            id: id,
        };
        $.post("/Event/EventPrice", param).done(function (res) {
            console.log(res);
            $("#Price").val(res.eventOffPrice);

        }).fail(function () {
            showerrors("Invalid Salary!!!");
        });

    }
    function validateEventBooking() {
        var selectedValue = $("#eventid").val();
        let isvalidated = true;
        let msg = "<ul>";

        function addError(message) {
            msg += `<li>${message}</li>`;
            isvalidated = false;
        }
        if ($("#eventid").val() === "") {
            addError("Please enter birthday boy/girl name");
        }
        if (selectedValue == 1) {
            if ($("#bname").val() === "") {
                addError("Please enter birthday boy/girl name");
            }
        }
        else {
            if ($("#cname").val() === "") {
                addError("Please enter couple name");
            }
        }
        if ($("#PhoneNo").val() === "") {
            addError("Please enter event name");
        }
        if ($("#TotalGuest").val() === "") {
            addError("Please enter no. of people");
        }
        if ($("#date").val() === "") {
            addError("Please enter date");
        }
        if ($("#time").val() === "") {
            addError("Please enter  time");
        }

        if (!isvalidated) {
            msg += "</ul>";
            Hide_Loader();
            showerrors(msg);
        }

        return isvalidated;
    }


    function onpayment() {
        if (validateTableBooking()) {
            $.post("/checkout/checkout")
                .done(function (res) {
                    $("#PaymentModalPV").html(res);
                })
                .fail(function () {
                    alert("error");
                });
        }
    }
    function Orderbook() {
        checkoutOrder();
    }
    function info() {
        alert("Apologies, but this service is currently unavailable. Please make payment using only the QR code method.");

    }
    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    function CreateQR() {
        var link = $("#dp").val();
        var randomColor = getRandomColor();

        var qrcode = new QRCode("qrcode", {
            text: link,
            width: 125,
            height: 120,
            colorDark: randomColor, // Change this to color: randomColor,
        });
        document.getElementById("qrcode").style.backgroundColor = randomColor;
    }

    CreateQR();
</script>

